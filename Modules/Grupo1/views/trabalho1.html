<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantidade de pacotes por porta</title>

    <script src="
        https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js
        "></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>

    <div class="container">
        <div class="card mt-5" style="width: 100%;">
            <div class="card-body">
                <h5 class="card-title">Quantidade de pacotes por portas</h5>
                <h6 class="card-subtitle mb-2 text-body-secondary">Esse gráfico mostra a quantidade de pacotes para cada
                    porta</h6>
                <div class="card-text pt-3 text-center">
                    <div id="main" class="m-auto" style="width: 80%;height:500px;"></div>
                </div>
            </div>
        </div>

    </div>


    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
        integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script type="text/javascript">
        let data;
        // Função que faz a requisição fetch para o servidor
        async function getAnalise() {
            url = "http://localhost:3001/grupo1/trabalho1"
            const response = await fetch(url);
            data = await response.json();
        }

        // Função principal, precisa dela para esperar a função getAnalise terminar
        async function main() {
            await getAnalise();
            // Transforma data.Portas em um array de objetos
            let portas = Object.keys(data.Portas).map((porta) => {
                return {
                    name: porta,
                    value: data.Portas[porta]
                }
            });

            // Pega o elemento HTML onde o gráfico será exibido
            var graficoPacotesPorIP = echarts.init(document.getElementById('main'));

            var option = {
                title: {
                    text: 'Quantidade de pacotes por portas',
                },
                tooltip: {
                    trigger: 'item'
                },
                legend: {
                    orient: 'vertical',
                    left: 'right'
                },
                series: [
                    {
                        name: 'Pacotes por porta',
                        type: 'pie',
                        radius: '50%',
                        data: portas,
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            };

            // Mostra o gráfico e seta as opções
            graficoPacotesPorIP.setOption(option);
        }
        main();
    </script>
</body>

</html>